{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "<img src=\"https://raw.githubusercontent.com/RishiCPS/SentinelImages/main/28.png\" alt=\"Trustwave Logo\" width=\"180\"/> \r\n## ISA One Stop Shop - Version 4"
      },
      "name": "text - 18"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "ccd5adcd-8d59-4cfe-99ec-98075de2e253",
            "version": "KqlParameterItem/1.0",
            "name": "DefaultSubscription_Internal",
            "type": 1,
            "isRequired": true,
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| take 1\r\n| project subscriptionId",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "1ca69445-60fc-4806-b43d-ac7e6aad630a",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "query": "summarize by subscriptionId\r\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\r\n",
            "crossComponentResources": [
              "value::selected"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "label": "☁️ Subscription"
          },
          {
            "id": "e94aafa3-c5d9-4523-89f0-4e87aa754511",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "label": "🗂️ Workspace",
            "type": 5,
            "isRequired": true,
            "query": "resources\n| where type =~ 'microsoft.operationalinsights/workspaces' \n//| where subscriptionId == '{Subscription:id}'\n| project id",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "value": "/subscriptions/b4a10294-e9a4-47e3-8dab-94cc23dd16d7/resourceGroups/Sentinel-PROD-RG/providers/Microsoft.OperationalInsights/workspaces/BDOSecure-LAW",
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.operationalinsights/workspaces": true
              },
              "additionalResourceOptions": []
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "eafaa0ec-7c3a-4ee5-babe-9850080c909d",
            "version": "KqlParameterItem/1.0",
            "name": "resourceGroup",
            "type": 1,
            "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| where id == \"{Workspace}\"\r\n| project resourceGroup",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "c4b69c01-2263-4ada-8d9c-43433b739ff3",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "⏱️ Time Range",
            "type": 4,
            "isRequired": true,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "value": {
              "durationMs": 7776000000
            }
          },
          {
            "id": "27308a9d-46a2-4fca-8035-e813201fb4f8",
            "version": "KqlParameterItem/1.0",
            "name": "GBperday",
            "type": 1,
            "description": "Shows Average per Day over selected Duration (GB)",
            "query": "Usage\r\n| where TimeGenerated > startofday({TimeRange:start}) and TimeGenerated < startofday({TimeRange:end})\r\n// Only look at chargeable Tables\r\n| where IsBillable == True\r\n| summarize\r\nTotalBytes =round(sum(Quantity))\r\nby bin(TimeGenerated, 1d)\r\n| summarize GBperday = round(avg(TotalBytes)/1000,2)\r\n",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "22ed8771-4f7a-4ed1-bb14-882b863be85e",
            "version": "KqlParameterItem/1.0",
            "name": "selectDepthLevel",
            "label": "Select the detail level",
            "type": 10,
            "description": "Basic data (default) will load much faster than Advanced insight into the data",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n { \"value\": \"Basic\", \"label\": \"Basic\", \"selected\":true },\r\n { \"value\": \"Advanced\", \"label\": \"Advanced\" }\r\n ]"
          },
          {
            "id": "c71f3009-a3f4-4aa5-aaf0-d0f667100e56",
            "version": "KqlParameterItem/1.0",
            "name": "Help",
            "label": "📖 Help",
            "type": 10,
            "description": "This will show some help information to help you understand the page you are on",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n { \"value\": \"Yes\", \"label\": \"Yes\"},\r\n { \"value\": \"No\", \"label\": \"No\", \"selected\":true },\r\n { \"value\": \"Change Log\", \"label\": \"Change Log\"}\r\n]"
          },
          {
            "id": "bd9b6f2d-3e7b-4d2c-83b4-f77154f6af42",
            "version": "KqlParameterItem/1.0",
            "name": "GBtotal",
            "type": 1,
            "query": "Usage\r\n| where StartTime {TimeRange:value}\r\n| where IsBillable == True\r\n| parse ResourceUri with *'/subscriptions/' SubscriptionId '/resourcegroups/'*\r\n| where SubscriptionId == '{Subscription:id}'\r\n| summarize Gbytes = sum(Quantity)/1000  by SubscriptionId\r\n| project TotalGBytes = round(Gbytes,2)",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 2592000000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 1"
    },
    {
      "type": 1,
      "content": {
        "json": "<hr style=\"border: 1px solid #0000FF;\" />\r\n"
      },
      "name": "text - 11"
    },
    {
      "type": 1,
      "content": {
        "json": "\r\n### Change Log\r\n\r\n|Version|Description|\r\n|---|---|\r\n|v0.0| Initial Draft Dashboard created|\r\n|v0.1| Added key metrics for Morning Health Checks including data ingestion, connector status, and alert volume.|\r\n|v0.2| Updated Analytics Health|\r\n|v0.3| Adding Mitre TTP Comparision|\r\n|v0.4| Adding SIEM Optimization Recommendations|\r\n"
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "Change Log"
      },
      "customWidth": "50",
      "name": "text - 7"
    },
    {
      "type": 1,
      "content": {
        "json": "## Usage\r\n\t- Please select your **Subscription** and **Workspace**\r\n\t- Time Range: is the time you wish to query back to. i.e 7days from now, into the past.\r\n\t- Help is available in various parts of this Workbook.\r\n\t- Select the Detail Level - is a toggle to reduce the page load time of certain queries.\r\n\r\n\r\n| **Tab** | **Description** |\r\n|---|---|\r\n| **Incident Overview - DC** | Provides a comprehensive view of incident health and highlights any actions required from the GTO team. This **daily** check ensures that all incidents are monitored and addressed promptly. |\r\n| **Ingestion - DC** | Displays the overall health of data ingestion processes. This **daily** check helps identify any issues with data flow to maintain optimal SIEM performance. |\r\n| **Agents Health - DC** | Offers an overview of the health and status of all agents. This **daily** check ensures that all agents are active and reporting correctly, preventing data collection gaps. |\r\n| **Content Hub - WC** | Contains instructions and data for monitoring the overall health of Content Hub. This **weekly** check is essential for ensuring that all Content is up-to-date. |\r\n| **Analytics Health - WC** | Contains instructions and data for monitoring the overall health of analytics rules. This **weekly** check is essential for ensuring that all analytic rules are functioning correctly and providing accurate insights. |\r\n| **Sentinel What's New** | Links to the official Microsoft page for the latest updates and features in Sentinel. Regularly reviewing this section ensures you stay informed about new capabilities and changes in the platform. |\r\n| **Capacity Planning - MC / EBR** | Provides data for capacity planning discussions during **Monthly** Checks or Enterprise Business Review (EBR) meetings. This information helps in resource allocation and scaling decisions. |\r\n| **ISA Hand Book** | Link to Trustwave ISA Handbook and other resources. |\r\n| **Trustwave Senitnel Communiation** | Comms from Trustwave Sentinel Forum |\r\n| **SIEM Optimization Recommendations** | POC |\r\n\r\n\r\n---\r\n\r\n"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "Help",
          "comparison": "isEqualTo",
          "value": "Yes"
        },
        {
          "parameterName": "Help",
          "comparison": "isEqualTo",
          "value": "Yes"
        }
      ],
      "name": "text - 0 - Copy"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "tabStyle": "smaller",
        "links": [
          {
            "id": "ad9f9173-35b3-4c1a-84e4-6f6062263c18",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "| Incident Overview - DC",
            "subTarget": "incidents",
            "style": "link"
          },
          {
            "id": "d3143cd8-a610-4ce9-990d-3e6674fcb5e2",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "| Ingestion - DC",
            "subTarget": "ingestion",
            "style": "link"
          },
          {
            "id": "18c99658-c4e7-4cef-9d25-c49056355810",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "| Agents - DC",
            "subTarget": "agents",
            "style": "link"
          },
          {
            "id": "34d5d88a-469f-4264-9e8e-1ca93296d716",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "| Content Hub - WC",
            "subTarget": "contentHub",
            "style": "link"
          },
          {
            "id": "f7114e16-4a3b-4caa-834a-91cadfe6b8de",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "|  Analytics Health - WC",
            "subTarget": "analytics",
            "style": "link"
          },
          {
            "id": "fbc10b54-31d5-4571-aee6-09ae21118eb0",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "| Data Connectors - MC",
            "subTarget": "dataConnectors",
            "style": "link"
          },
          {
            "id": "e2582d39-3a29-41ab-9a7c-4df62e79784c",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "| Sentinel What's New - MC ",
            "subTarget": "new",
            "style": "link"
          },
          {
            "id": "a56b10fb-0e65-4308-9c9e-e6c56ef356c6",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "| Capacity Planning - MC / EBR",
            "subTarget": "capacity",
            "style": "link"
          },
          {
            "id": "fc9f1252-ebf3-4eb5-a87b-638a2d6a1733",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "| MITRE ATT&CK Mapping  - MC / EBR",
            "subTarget": "mitre",
            "style": "link"
          },
          {
            "id": "6d992ce3-674c-4b1b-862d-409138c03825",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "| Trustwave Senitnel Communiation",
            "subTarget": "comms",
            "style": "link"
          },
          {
            "id": "b208e32f-38fd-4bc2-acd2-0ab2e81df8ca",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "| SIEM Optimization Recommendations |",
            "subTarget": "recommendations",
            "style": "link"
          }
        ]
      },
      "name": "links - 7"
    },
    {
      "type": 1,
      "content": {
        "json": "<hr style=\"border: 1px solid #0000FF;\" />\r\n"
      },
      "name": "text - 11 - Copy"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Incident Overview",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "**Note:** This panel in the dashboard is only for your reference. Please double-check the information before releasing it to the customer or GTO. Also for Incident Health Check select the time range from below selector.\r\n",
              "style": "upsell"
            },
            "name": "text - 3"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "43f7b790-5f65-4e44-944e-2442ab95e586",
                  "version": "KqlParameterItem/1.0",
                  "name": "TimeRangeInc",
                  "label": "Select Time Range",
                  "type": 4,
                  "description": " Default : 48 hrs",
                  "isRequired": true,
                  "typeSettings": {
                    "selectableValues": [
                      {
                        "durationMs": 300000
                      },
                      {
                        "durationMs": 900000
                      },
                      {
                        "durationMs": 1800000
                      },
                      {
                        "durationMs": 3600000
                      },
                      {
                        "durationMs": 14400000
                      },
                      {
                        "durationMs": 43200000
                      },
                      {
                        "durationMs": 86400000
                      },
                      {
                        "durationMs": 172800000
                      },
                      {
                        "durationMs": 259200000
                      },
                      {
                        "durationMs": 604800000
                      },
                      {
                        "durationMs": 1209600000
                      },
                      {
                        "durationMs": 2419200000
                      },
                      {
                        "durationMs": 2592000000
                      },
                      {
                        "durationMs": 5184000000
                      },
                      {
                        "durationMs": 7776000000
                      }
                    ],
                    "allowCustom": true
                  },
                  "value": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "100",
            "name": "parameters - 6"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityIncident\r\n| where CreatedTime >= {TimeRangeInc:start} and CreatedTime <= {TimeRangeInc:end}\r\n| extend Severity = tostring(Severity)\r\n| extend Severity = tostring(replace(\"[\\\\[\\\\]\\\"]\", \"\", Severity))\r\n| summarize dcount(IncidentNumber) by Severity",
              "size": 0,
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "piechart"
            },
            "name": "query - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityIncident\r\n| where CreatedTime >= {TimeRangeInc:start} and CreatedTime <= {TimeRangeInc:end}\r\n| summarize CreatedTime = min(CreatedTime),     FirstModifiedTime = min(FirstModifiedTime),     ClosedTime = min(ClosedTime),     Severity = make_set(Severity),     Comments = make_set(Comments),     Title = any(Title),     ProviderName = any(ProviderName)     by IncidentNumber, IncidentName \r\n| extend Severity = tostring(Severity)\r\n| extend Severity = tostring(replace(\"[\\\\[\\\\]\\\"]\", \"\", Severity))\r\n| extend Response_Time_in_Minutes = iff(isnull(FirstModifiedTime), datetime_diff('minute', now(), CreatedTime), datetime_diff('minute', FirstModifiedTime, CreatedTime))\r\n| extend Close_Time_in_Minutes = iff(isnull(ClosedTime), datetime_diff('minute', now(), FirstModifiedTime), datetime_diff('minute', ClosedTime, FirstModifiedTime))\r\n| extend Response_Time_in_Hours_and_Minutes = strcat(\r\n    tostring(Response_Time_in_Minutes / 60), \" hours \", tostring(Response_Time_in_Minutes % 60), \" mins\"\r\n)\r\n| extend Status = iff(isnull(FirstModifiedTime), \"not picked up\", \"picked up\")\r\n| summarize \r\n    Title = any(Title), \r\n    Severity = any(Severity), \r\n    CreatedTime = any(CreatedTime), \r\n    Dwell_Time_in_Hours_and_Minutes = any(Response_Time_in_Hours_and_Minutes), \r\n    Status = any(Status),\r\n    Comments = any(Comments),\r\n    Dwell_Time_in_Minutes = any(Response_Time_in_Minutes),\r\n    Close_Time_in_Minutes_afterPickedUp = any(Close_Time_in_Minutes),\r\n    FirstModifiedTime = any(FirstModifiedTime), \r\n    ClosedTime = any(ClosedTime),\r\n    ProviderName = any(ProviderName)\r\n    by IncidentNumber\r\n| sort by IncidentNumber\r\n\r\n    ",
              "size": 3,
              "noDataMessageStyle": 2,
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Comments",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "IncidentNumber",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "IncidentNumber",
                  "sortOrder": 2
                }
              ]
            },
            "name": "query - 5"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "incidents"
      },
      "name": "Incident Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Data Ingestion Health Check",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "bdc24a0e-bd68-4a3b-aa01-740283663b7f",
                  "version": "KqlParameterItem/1.0",
                  "name": "TimeRangeIng",
                  "label": "Select the Time Range",
                  "type": 4,
                  "description": "Default 90 days",
                  "isRequired": true,
                  "typeSettings": {
                    "selectableValues": [
                      {
                        "durationMs": 300000
                      },
                      {
                        "durationMs": 900000
                      },
                      {
                        "durationMs": 1800000
                      },
                      {
                        "durationMs": 3600000
                      },
                      {
                        "durationMs": 14400000
                      },
                      {
                        "durationMs": 43200000
                      },
                      {
                        "durationMs": 86400000
                      },
                      {
                        "durationMs": 172800000
                      },
                      {
                        "durationMs": 259200000
                      },
                      {
                        "durationMs": 604800000
                      },
                      {
                        "durationMs": 1209600000
                      },
                      {
                        "durationMs": 2419200000
                      },
                      {
                        "durationMs": 2592000000
                      },
                      {
                        "durationMs": 5184000000
                      },
                      {
                        "durationMs": 7776000000
                      }
                    ],
                    "allowCustom": true
                  },
                  "value": {
                    "durationMs": 7776000000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 8"
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n# Check the overall log volume ingestion trend per week.\r\n##### Ignore 1st, 2nd and Last Row of the Table"
            },
            "name": "text - 10"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage\r\n| where StartTime {TimeRangeIng:value}\r\n| where IsBillable == True\r\n| summarize totalGBytes = sum(Quantity) by bin(TimeGenerated, 7d)\r\n| order by TimeGenerated asc\r\n| serialize \r\n| extend changeInGB = totalGBytes - prev(totalGBytes, 1)\r\n| extend pctChange = (changeInGB * 100) / prev(totalGBytes, 1)\r\n// Calculate the number of days between the current row and the next row\r\n| extend nextTimeGenerated = next(TimeGenerated, 1)\r\n// Handle last row and ensure the number of days is correct\r\n| extend NumberOfDaysConsidered = iff(isnull(nextTimeGenerated), datetime_diff(\"day\", now(), TimeGenerated), datetime_diff(\"day\", nextTimeGenerated, TimeGenerated))\r\n// Format TimeGenerated after calculations\r\n| extend TimeGenerated = strcat(format_datetime(TimeGenerated, 'yyyy-MM-dd'), \", Week of year: \", week_of_year(TimeGenerated))\r\n\r\n",
              "size": 2,
              "aggregation": 3,
              "showAnalytics": true,
              "title": "Data change (GBytes) and % , from: {TimeRange:label} grouping: Weekly",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "showExpandCollapseGrid": true,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 27,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "totalGBytes",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 38,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "changeInGB",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 38,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumSignificantDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "pctChange",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "hotCold"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumSignificantDigits": 2
                      }
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "changeInGB",
                    "label": "Change from last period (GBytes)"
                  },
                  {
                    "columnId": "pctChange",
                    "label": "% Change"
                  }
                ]
              },
              "chartSettings": {
                "showMetrics": false,
                "seriesLabelSettings": [
                  {
                    "seriesName": "BillingVolumeNow",
                    "color": "green"
                  },
                  {
                    "seriesName": "BillingForecast",
                    "color": "redBright"
                  }
                ]
              }
            },
            "customWidth": "100",
            "name": "query - 20 - Copy - Copy"
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n# Check when was the Last event received\r\n#### Set the threshold in the below Drop Down. Recommendation 7 days as not all Tables recieve data every hour. "
            },
            "name": "text - 4"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "7e985447-1426-44cc-9c80-75aad9458b93",
                  "version": "KqlParameterItem/1.0",
                  "name": "LastLogRecivedThreshold",
                  "label": "Set the Last log received threshold",
                  "type": 2,
                  "description": "Select the last log recived threshold, to filter the table below",
                  "isRequired": true,
                  "value": "3600",
                  "typeSettings": {
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"0\",\"label\":\"None\"},{\"value\":\"3600\",\"label\":\"1h\"},{\"value\":\"21600\",\"label\":\"6h\"},{\"value\":\"43200\",\"label\":\"12h\"}, {\"value\":\"86400\",\"label\":\"1d\"},{\"value\":\"172800\",\"label\":\"2d\"},{\"value\":\"604800\",\"label\":\"7d\"}]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "formVertical",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "100",
            "name": "parameters - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union withsource = _TableName *\r\n| where TimeGenerated {TimeRangeIng:query}\r\n| summarize last_log = datetime_diff(\"second\",now(), max(TimeGenerated))  by _TableName\r\n| where last_log > {LastLogRecivedThreshold}\r\n| project ['Table Name'] = _TableName,  ['Last Record Received'] =  last_log \r\n | order by ['Last Record Received']  desc\r\n\r\n ",
              "size": 0,
              "showAnalytics": true,
              "title": "Last data received, by table",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Table Name",
              "exportParameterName": "Table",
              "exportDefaultValue": "All Tables",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Last Record Received",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "orangeRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumSignificantDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "coldHot"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Size per Entry",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "orange"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "IsBillable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "False",
                          "representation": "blueDark",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Estimated Table Price",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Trend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "redGreen"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_heatmap_Last Record Received_1",
                    "sortOrder": 2
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "Table Name",
                    "label": "Table name"
                  },
                  {
                    "columnId": "Last Record Received",
                    "label": "Last record received",
                    "comment": "When did the last record arrive?"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_heatmap_Last Record Received_1",
                  "sortOrder": 2
                }
              ]
            },
            "customWidth": "50",
            "showPin": true,
            "name": "query - 2 - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/dataConnectors\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-11-01-preview\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.connectorUiConfig.title\",\"columnid\":\"Title\"},{\"path\":\"properties.connectorUiConfig..dataTypes[*].name\",\"columnid\":\"TableName\"},{\"path\":\"properties.connectorUiConfig.publisher\",\"columnid\":\"Publisher\"}]}}]}",
              "size": 1,
              "title": "Enter the Table Name here to find the Data Connector Name. Some Tables does not come from the data connectors but come from the Sentinel Configuration.",
              "noDataMessage": "Some Tables does not come from the data connectors but come from the Sentinel Configuration",
              "noDataMessageStyle": 2,
              "showExportToExcel": true,
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "requiredDataConnectors",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "Data Connectors",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "queryText",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "resourcegroup",
                    "formatter": 14,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Title",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Title",
                  "sortOrder": 2
                }
              ]
            },
            "customWidth": "50",
            "name": "query - 21 - Rules"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where TimeGenerated {TimeRangeIng:query}\r\n| summarize last_log = datetime_diff(\"second\",now(), max(TimeGenerated))  by DeviceVendor\r\n| where last_log > {LastLogRecivedThreshold}\r\n| project ['Device Vendor'] = DeviceVendor,  ['Last Record Received'] =  last_log \r\n | order by ['Last Record Received']  desc\r\n\r\n ",
              "size": 0,
              "showAnalytics": true,
              "title": "Last data received, by CEF device vendor",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Table Name",
              "exportParameterName": "Table",
              "exportDefaultValue": "All Tables",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Last Record Received",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "orangeRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumSignificantDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "coldHot"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Size per Entry",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "orange"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "IsBillable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "False",
                          "representation": "blueDark",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Estimated Table Price",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Trend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "redGreen"
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Device Vendor",
                    "label": "Device vendor"
                  },
                  {
                    "columnId": "Last Record Received",
                    "label": "Last record received",
                    "comment": "When did the last record arrive?"
                  }
                ]
              }
            },
            "customWidth": "50",
            "showPin": true,
            "name": "query - 2 - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where TimeGenerated {TimeRangeIng:query}\r\n| summarize last_log = datetime_diff(\"second\",now(), max(TimeGenerated))  by _ResourceId, Computer\r\n| where last_log > {LastLogRecivedThreshold}\r\n| project ['Azure resource'] = _ResourceId, Computer,  ['Last Record Received'] =  last_log \r\n | order by ['Last Record Received']  desc\r\n ",
              "size": 0,
              "showAnalytics": true,
              "title": "CommonSecurityLog (CEF): Last data received, by computer",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Table Name",
              "exportParameterName": "Table",
              "exportDefaultValue": "All Tables",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Last Record Received",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "orangeRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumSignificantDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "coldHot"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Size per Entry",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "orange"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "IsBillable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "False",
                          "representation": "blueDark",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Estimated Table Price",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Trend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "redGreen"
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Last Record Received",
                    "label": "Last record received"
                  }
                ]
              }
            },
            "customWidth": "50",
            "showPin": true,
            "name": "query - 2 - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Syslog\r\n| where TimeGenerated {TimeRangeIng:query}\r\n| summarize last_log = datetime_diff(\"second\",now(), max(TimeGenerated))  by _ResourceId, Computer\r\n| where last_log > {LastLogRecivedThreshold}\r\n| project ['Azure resource'] = _ResourceId, Computer,  ['Last Record Received'] =  last_log \r\n | order by ['Last Record Received']  desc\r\n\r\n ",
              "size": 0,
              "showAnalytics": true,
              "title": "Syslog: Last data received, by computer",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Table Name",
              "exportParameterName": "Table",
              "exportDefaultValue": "All Tables",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Last Record Received",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "orangeRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumSignificantDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "coldHot"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Size per Entry",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "orange"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "IsBillable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "False",
                          "representation": "blueDark",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Estimated Table Price",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Trend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "redGreen"
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Last Record Received",
                    "label": "Last record received"
                  }
                ]
              }
            },
            "customWidth": "50",
            "showPin": true,
            "name": "query - 2 - Copy - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where TimeGenerated {TimeRangeIng:query}\r\n| summarize last_log = datetime_diff(\"second\",now(), max(TimeGenerated))  by _ResourceId, Computer\r\n| where last_log > {LastLogRecivedThreshold}\r\n| project ['Azure resource'] = _ResourceId, Computer,  ['Last Record Received'] =  last_log \r\n | order by ['Last Record Received']  desc\r\n ",
              "size": 0,
              "showAnalytics": true,
              "title": "SecurityEvent: Last data received, by computer",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Table Name",
              "exportParameterName": "Table",
              "exportDefaultValue": "All Tables",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Last Record Received",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "orangeRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumSignificantDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "coldHot"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Size per Entry",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "orange"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "IsBillable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "False",
                          "representation": "blueDark",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Estimated Table Price",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Trend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "redGreen"
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Last Record Received",
                    "label": "Last record received",
                    "comment": "When did the last record arrive?"
                  }
                ]
              }
            },
            "customWidth": "50",
            "showPin": true,
            "name": "query - 2 - Copy - Copy - Copy - Copy - Copy"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "ingestion"
      },
      "name": "ingestion"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### Make sure to select your machines' enviroment: \r\n- Azure managed machines - show statistics for Azure VMs or Azure Arc managed servers\r\n- All machines - show statistics for all machines, including non-Azure servers reporting via the Microsoft Monitoring Agent (MMA)"
            },
            "name": "text - 5"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "4cfd60bb-7de0-46c1-9cae-7a933948bf8d",
                  "cellValue": "OnPrem",
                  "linkTarget": "parameter",
                  "linkLabel": "Azure managed machines",
                  "subTarget": "No",
                  "preText": "Azure VMs",
                  "style": "link"
                },
                {
                  "id": "d2fed116-caff-483f-bbad-ba07302f1777",
                  "cellValue": "OnPrem",
                  "linkTarget": "parameter",
                  "linkLabel": "All machines",
                  "subTarget": "Yes",
                  "style": "link"
                }
              ]
            },
            "name": "links - 19"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "parameters": [
                      {
                        "id": "d2922a2e-e093-47eb-862f-50a647e3f30d",
                        "version": "KqlParameterItem/1.0",
                        "name": "TableName",
                        "label": "Table name filter",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "union withsource=_TableName *\r\n| summarize by _TableName",
                        "value": [
                          "value::all"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "",
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "c6e118c5-f30b-4d06-a5a6-59645318df64",
                        "version": "KqlParameterItem/1.0",
                        "name": "VMfilter",
                        "label": "Machine name filter",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "union withsource=_TableName *\r\n| where _TableName in ({TableName})\r\n| where _ResourceId contains \"virtualmachines\"\r\n| where _ResourceId != \" \"\r\n| summarize by value = _ResourceId\r\n| extend label = extract(\".*/([^/]+)\",1, value) ",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "value": [
                          "value::all"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 11"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Select a location to filter the display below.",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Help",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 15"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat\r\n| where tolower(ResourceId) in ({VMfilter})\r\n| summarize dcount(Computer) by RemoteIPCountry, Computer",
                    "size": 0,
                    "title": "Computers' location",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "regionName",
                    "exportParameterName": "regionName",
                    "exportDefaultValue": "All",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "map",
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "RemoteIPCountry",
                      "sizeSettings": "dcount_Computer",
                      "sizeAggregation": "Sum",
                      "legendMetric": "dcount_Computer",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "nodeColorField": "dcount_Computer",
                        "colorAggregation": "Sum",
                        "type": "heatmap",
                        "heatmapPalette": "orangeBlue",
                        "heatmapMin": 0
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 7"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat\r\n| where tolower(ResourceId) in ({VMfilter})\r\n| where RemoteIPCountry == \"{regionName}\" or \"{regionName}\" == \"All\"\r\n| summarize AggregatedValue = dcount(Computer) by [\"OS\"]=iff(isempty(OSName), OSType, OSName)",
                    "size": 0,
                    "title": "Computer OS",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "OS",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "AggregatedValue",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 9"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Computer heartbeat tracking: {TimeRange}"
                  },
                  "name": "text - 11"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "e0fb3c9a-f42f-4dfb-a86c-f4dd36584904",
                        "version": "KqlParameterItem/1.0",
                        "name": "UnhealthyCriteria",
                        "label": "Unhealthy definition",
                        "type": 2,
                        "isRequired": true,
                        "jsonData": "[\r\n    { \"value\":\"1m\", \"label\":\"1 minute without heartbeat\", \"selected\":false },\r\n    { \"value\":\"5m\", \"label\":\"5 minutes without heartbeat\", \"selected\":false },\r\n    { \"value\":\"30m\", \"label\":\"30 minutes without heartbeat\", \"selected\":false },\r\n    { \"value\":\"1h\", \"label\":\"1 hour without heartbeat\", \"selected\":true },\r\n    { \"value\":\"2h\", \"label\":\"2 hours without heartbeat\", \"selected\":false },\r\n    { \"value\":\"8h\", \"label\":\"8 hours without heartbeat\", \"selected\":false },\r\n    { \"value\":\"1d\", \"label\":\"1 day without heartbeat\", \"selected\":false },\r\n    { \"value\":\"2d\", \"label\":\"2 days without heartbeat\", \"selected\":false },\r\n    { \"value\":\"7d\", \"label\":\"7 days without heartbeat\", \"selected\":false }\r\n]",
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 13"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Select a computer from the table to measure the heartbeat and latency of a specific computer. The latency is measured by comparing the result of the **ingestion_time()** function to the value of the **TimeGenerated** property.",
                    "style": "info"
                  },
                  "name": "text - 15 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat\r\n| where tolower(ResourceId) in ({VMfilter})\r\n| where TimeGenerated {TimeRange:query}\r\n| where RemoteIPCountry == \"{regionName}\" or \"{regionName}\" == \"All\"\r\n| summarize LastHeartbeat = max(TimeGenerated) by Computer\r\n| extend State = iff(LastHeartbeat < ago({UnhealthyCriteria}), 'Unhealthy', 'Healthy')\r\n| extend TimeFromNow = now() - LastHeartbeat\r\n| extend [\"TimeAgo\"] = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| join (\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| extend Packed = pack_all()\r\n) on Computer\r\n| where TimeGenerated == LastHeartbeat\r\n| join (\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| make-series InternalTrend=iff(count() > 0, 1, 0) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {UnhealthyCriteria} by Computer\r\n| extend Trend=array_slice(InternalTrend, array_length(InternalTrend) - 30, array_length(InternalTrend)-1)\r\n| extend (s_min, s_minId, s_max, s_maxId, s_avg, s_var, s_stdev) = series_stats(Trend)\r\n| project Computer, Trend, s_avg\r\n) on Computer\r\n| order by State, s_avg asc, TimeAgo\r\n| project [\"_ComputerName_\"] = Computer, [\"Computer\"]=strcat('🖥️ ', Computer), State, [\"Environment\"] = iff(ComputerEnvironment == \"Azure\", ComputerEnvironment, Category), [\"OS\"]=iff(isempty(OSName), OSType, OSName), [\"Azure Resource\"]=ResourceId, [\"Time\"]=strcat('🕒 ', TimeAgo), [\"Heartbeat Trend\"]=Trend, [\"Details\"]=Packed, [\"Computer Region\"] = RemoteIPCountry",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "{TimeRange:label}: all agent heartbeat data ",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "_ComputerName_",
                    "exportParameterName": "ComputerName",
                    "exportDefaultValue": "All",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "_ComputerName_",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Computer",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Healthy",
                                "representation": "Available",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Unhealthy",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Environment",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Azure",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Direct Agent",
                                "representation": "magenta",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "SCOM Agent",
                                "representation": "purple",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "SCOM Management Server",
                                "representation": "gray",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Heartbeat Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          }
                        },
                        {
                          "columnMatch": "Details",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_thresholds_State_2",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "State",
                          "label": "Health status"
                        },
                        {
                          "columnId": "Azure Resource",
                          "label": "Azure resource"
                        },
                        {
                          "columnId": "Time",
                          "label": "Time of last heartbeat"
                        },
                        {
                          "columnId": "Heartbeat Trend",
                          "label": "Heartbeat history"
                        },
                        {
                          "columnId": "Computer Region",
                          "label": "Computer region"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_State_2",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "showPin": true,
                  "name": "query - 16"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat  \r\n| where Computer startswith \"{ComputerName}\"\r\n| summarize ['Heartbeats per hour'] = count() by bin(TimeGenerated,1h) ",
                    "size": 0,
                    "title": "Heartbeats per hour: {ComputerName}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "categoricalbar",
                    "chartSettings": {
                      "showLegend": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "ComputerName",
                    "comparison": "isNotEqualTo",
                    "value": "All"
                  },
                  "name": "query - 13"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat  \r\n| where Computer startswith \"{ComputerName}\"\r\n| extend E2EIngestionLatency = todouble(datetime_diff(\"Second\",ingestion_time(),TimeGenerated))/60 \r\n| extend AgentLatency        = todouble(datetime_diff(\"Second\",_TimeReceived,TimeGenerated))/60 \r\n| summarize avg(E2EIngestionLatency),avg(AgentLatency) by bin(TimeGenerated,1h) \r\n| project TimeGenerated, ['End-to-end latency'] = avg_E2EIngestionLatency, ['Agent Latency'] = avg_AgentLatency\r\n",
                    "size": 0,
                    "title": "Average heartbeat latency: {ComputerName}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "timechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "avgE2E",
                          "formatter": 0,
                          "formatOptions": {
                            "showIcon": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ]
                    },
                    "tileSettings": {
                      "showBorder": false
                    },
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "unit": 24
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "ComputerName",
                    "comparison": "isNotEqualTo",
                    "value": "All"
                  },
                  "name": "query - 14"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "OnPrem",
              "comparison": "isEqualTo",
              "value": "No"
            },
            "name": "Azure VMs"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "parameters": [
                      {
                        "id": "d2922a2e-e093-47eb-862f-50a647e3f30d",
                        "version": "KqlParameterItem/1.0",
                        "name": "TableName",
                        "label": "Table name filter",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "union withsource= _TableName *\r\n| where Computer != \"\"\r\n| summarize by [\"Table name\"] = _TableName",
                        "value": [
                          "value::all"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "",
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "c6e118c5-f30b-4d06-a5a6-59645318df64",
                        "version": "KqlParameterItem/1.0",
                        "name": "VMfilter",
                        "label": "Machine name filter",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "union withsource= _TableName *\r\n| where _TableName in ({TableName})\r\n| where Computer != \"\"\r\n| summarize by value = Computer\r\n| extend label = value",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "value": [
                          "value::all"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 11"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Select a location to filter the display below.",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Help",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 15"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat\r\n| where Computer in ({VMfilter})\r\n| summarize dcount(Computer) by RemoteIPCountry, Computer",
                    "size": 0,
                    "title": "Computers' location",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "regionName",
                    "exportParameterName": "regionName",
                    "exportDefaultValue": "All",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "map",
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "RemoteIPCountry",
                      "sizeSettings": "dcount_Computer",
                      "sizeAggregation": "Sum",
                      "legendMetric": "dcount_Computer",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "nodeColorField": "dcount_Computer",
                        "colorAggregation": "Sum",
                        "type": "heatmap",
                        "heatmapPalette": "orangeBlue",
                        "heatmapMin": 0
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 7"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat\r\n| where Computer in ({VMfilter})\r\n| where RemoteIPCountry == \"{regionName}\" or \"{regionName}\" == \"All\"\r\n| summarize AggregatedValue = dcount(Computer) by [\"OS\"]=iff(isempty(OSName), OSType, OSName)",
                    "size": 0,
                    "title": "Computer OS",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "OS",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "AggregatedValue",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 9"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Computer heartbeat tracking: {TimeRange}"
                  },
                  "name": "text - 11"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "e0fb3c9a-f42f-4dfb-a86c-f4dd36584904",
                        "version": "KqlParameterItem/1.0",
                        "name": "UnhealthyCriteria",
                        "label": "Unhealthy definition",
                        "type": 2,
                        "isRequired": true,
                        "jsonData": "[\r\n    { \"value\":\"1m\", \"label\":\"1 minute without heartbeat\", \"selected\":false },\r\n    { \"value\":\"5m\", \"label\":\"5 minutes without heartbeat\", \"selected\":false },\r\n    { \"value\":\"30m\", \"label\":\"30 minutes without heartbeat\", \"selected\":false },\r\n    { \"value\":\"1h\", \"label\":\"1 hour without heartbeat\", \"selected\":true },\r\n    { \"value\":\"2h\", \"label\":\"2 hours without heartbeat\", \"selected\":false },\r\n    { \"value\":\"8h\", \"label\":\"8 hours without heartbeat\", \"selected\":false },\r\n    { \"value\":\"1d\", \"label\":\"1 day without heartbeat\", \"selected\":false },\r\n    { \"value\":\"2d\", \"label\":\"2 days without heartbeat\", \"selected\":false },\r\n    { \"value\":\"7d\", \"label\":\"7 days without heartbeat\", \"selected\":false }\r\n]",
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": "30m"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 13"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Select a computer from the table to measure the heartbeat and latency of a specific computer. The latency is measured by comparing the result of the **ingestion_time()** function to the value of the **TimeGenerated** property.",
                    "style": "info"
                  },
                  "name": "text - 15 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat\r\n| where Computer in ({VMfilter})\r\n| where TimeGenerated {TimeRange:query}\r\n| where RemoteIPCountry == \"{regionName}\" or \"{regionName}\" == \"All\"\r\n| summarize LastHeartbeat = max(TimeGenerated) by Computer\r\n| extend State = iff(LastHeartbeat < ago({UnhealthyCriteria}), 'Unhealthy', 'Healthy')\r\n| extend TimeFromNow = now() - LastHeartbeat\r\n| extend [\"TimeAgo\"] = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| join (\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| extend Packed = pack_all()\r\n) on Computer\r\n| where TimeGenerated == LastHeartbeat\r\n| join (\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| make-series InternalTrend=iff(count() > 0, 1, 0) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {UnhealthyCriteria} by Computer\r\n| extend Trend=array_slice(InternalTrend, array_length(InternalTrend) - 30, array_length(InternalTrend)-1)\r\n| extend (s_min, s_minId, s_max, s_maxId, s_avg, s_var, s_stdev) = series_stats(Trend)\r\n| project Computer, Trend, s_avg\r\n) on Computer\r\n| order by State, s_avg asc, TimeAgo\r\n| project [\"_ComputerName_\"] = Computer, [\"Computer\"]=strcat('🖥️ ', Computer), State, [\"Environment\"] = iff(ComputerEnvironment == \"Azure\", ComputerEnvironment, Category), [\"OS\"]=iff(isempty(OSName), OSType, OSName), [\"Azure Resource\"]=ResourceId, [\"Time\"]=strcat('🕒 ', TimeAgo), [\"Heartbeat Trend\"]=Trend, [\"Details\"]=Packed, [\"Computer Region\"] = RemoteIPCountry",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "{TimeRange:label}: all agent heartbeat data ",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "_ComputerName_",
                    "exportParameterName": "ComputerName",
                    "exportDefaultValue": "All",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "_ComputerName_",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Computer",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Healthy",
                                "representation": "Available",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Unhealthy",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Environment",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Azure",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Direct Agent",
                                "representation": "magenta",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "SCOM Agent",
                                "representation": "purple",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "SCOM Management Server",
                                "representation": "gray",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Heartbeat Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          }
                        },
                        {
                          "columnMatch": "Details",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_thresholds_State_2",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "State",
                          "label": "Health status"
                        },
                        {
                          "columnId": "Azure Resource",
                          "label": "Azure resource"
                        },
                        {
                          "columnId": "Time",
                          "label": "Time of last heartbeat"
                        },
                        {
                          "columnId": "Heartbeat Trend",
                          "label": "Heartbeat history"
                        },
                        {
                          "columnId": "Computer Region",
                          "label": "Computer region"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_State_2",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "showPin": true,
                  "name": "query - 16"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat  \r\n| where Computer startswith \"{ComputerName}\"\r\n| summarize ['Heartbeats per hour'] = count() by bin(TimeGenerated,1h) ",
                    "size": 0,
                    "title": "Heartbeats per hour: {ComputerName}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "categoricalbar",
                    "chartSettings": {
                      "showLegend": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "ComputerName",
                    "comparison": "isNotEqualTo",
                    "value": "All"
                  },
                  "name": "query - 13"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat  \r\n| where Computer startswith \"{ComputerName}\"\r\n| extend E2EIngestionLatency = todouble(datetime_diff(\"Second\",ingestion_time(),TimeGenerated))/60 \r\n| extend AgentLatency        = todouble(datetime_diff(\"Second\",_TimeReceived,TimeGenerated))/60 \r\n| summarize avg(E2EIngestionLatency),avg(AgentLatency) by bin(TimeGenerated,1h) \r\n| project TimeGenerated, ['End-to-end latency'] = avg_E2EIngestionLatency, ['Agent Latency'] = avg_AgentLatency\r\n",
                    "size": 0,
                    "title": "Average heartbeat latency: {ComputerName}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "timechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "avgE2E",
                          "formatter": 0,
                          "formatOptions": {
                            "showIcon": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ]
                    },
                    "tileSettings": {
                      "showBorder": false
                    },
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "unit": 24
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "ComputerName",
                    "comparison": "isNotEqualTo",
                    "value": "All"
                  },
                  "name": "query - 14"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "OnPrem",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "All machins"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "agents"
      },
      "name": "Agents info"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "capacity",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "170a6d54-0503-41ac-b52b-b0e3db2f427d",
                  "version": "KqlParameterItem/1.0",
                  "name": "Price",
                  "label": "Price estimation",
                  "type": 1,
                  "description": "Enter your price (tip.  Use the Azure Pricing Calculator, enter  a value of 1GB and divide by 30days), or see Help toggle",
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "4.0"
                      }
                    }
                  ]
                }
              ],
              "style": "above",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "name": "parameters - 1 - Copy"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "b2d72148-33fb-4afc-9860-476d2afb7b7f",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Overview",
                  "subTarget": "overview",
                  "style": "link"
                },
                {
                  "id": "ed5e9da0-5b84-413d-a198-0338b248f2b7",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Commitment Tier Recommendation",
                  "subTarget": "sentinel",
                  "style": "link"
                },
                {
                  "id": "bb092bc8-2753-40d1-9044-507915dcbbe8",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Table Analysis ",
                  "subTarget": "table",
                  "style": "link"
                },
                {
                  "id": "68478fa5-e791-4eb7-836f-4c7ba3002fda",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Syslog",
                  "subTarget": "syslog",
                  "style": "link"
                },
                {
                  "id": "7728c496-7831-4089-afc2-133fbe5fa06b",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Common Security Format (CEF)",
                  "subTarget": "cef",
                  "style": "link"
                }
              ]
            },
            "name": "links - 20"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Sentinel Usage",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "<svg xmlns=\"http://www.w3.org/2000/svg\" id=\"a75e3f3a-2661-410b-82fb-d300d37dea2d\" width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><defs><linearGradient id=\"aff60ddf-eec1-40bf-8bf5-f3e3b50e8818\" x1=\"9\" y1=\"16.21\" x2=\"9\" y2=\"0.62\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"#1b93eb\"/><stop offset=\"0.21\" stop-color=\"#2095eb\"/><stop offset=\"0.44\" stop-color=\"#2e9ced\"/><stop offset=\"0.69\" stop-color=\"#45a7ef\"/><stop offset=\"0.95\" stop-color=\"#64b6f1\"/><stop offset=\"1\" stop-color=\"#6bb9f2\"/></linearGradient></defs><title>Icon-security-248</title><path d=\"M16,8.44c0,4.57-5.53,8.25-6.73,9a.43.43,0,0,1-.46,0C7.57,16.69,2,13,2,8.44V2.94a.44.44,0,0,1,.43-.44C6.77,2.39,5.78.5,9,.5s2.23,1.89,6.53,2a.44.44,0,0,1,.43.44Z\" fill=\"#1b93eb\"/><path d=\"M15.38,8.48c0,4.2-5.07,7.57-6.17,8.25a.4.4,0,0,1-.42,0c-1.1-.68-6.17-4.05-6.17-8.25v-5A.41.41,0,0,1,3,3c3.94-.11,3-1.83,6-1.83S11.05,2.93,15,3a.41.41,0,0,1,.39.4Z\" fill=\"url(#aff60ddf-eec1-40bf-8bf5-f3e3b50e8818)\"/><path d=\"M9,6.53A2.88,2.88,0,0,1,11.84,9a.49.49,0,0,0,.49.4h1.4a.49.49,0,0,0,.5-.53,5.26,5.26,0,0,0-10.46,0,.49.49,0,0,0,.5.53h1.4A.49.49,0,0,0,6.16,9,2.88,2.88,0,0,1,9,6.53Z\" fill=\"#c3f1ff\"/><circle cx=\"9\" cy=\"9.4\" r=\"1.91\" fill=\"#fff\"/></svg>"
                  },
                  "name": "text - 7"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "923d55a3-75ac-4ce2-8820-50b4a530a553",
                        "version": "KqlParameterItem/1.0",
                        "name": "SentinelPrice",
                        "type": 1,
                        "description": "Enter a value for Sentinel Data cost, default: 2.0",
                        "value": "2.0",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "f809d158-af16-4583-95af-980cd064e15f",
                        "version": "KqlParameterItem/1.0",
                        "name": "Retention",
                        "label": "Retention price per GB",
                        "type": 1,
                        "description": "Obtain a value from the Azure Pricing Calculator, default: 0.10",
                        "value": "0.10"
                      },
                      {
                        "id": "8de07ce7-c61a-417b-a364-5fd3e52ad622",
                        "version": "KqlParameterItem/1.0",
                        "name": "retentionDays",
                        "label": "How many days retention are required? Defaults to current setting",
                        "type": 1,
                        "description": "Do you need to retain data for more than 90days in Sentinel? Defaults to current setting, alter for an estimate e.g 180days, max 730days. 1yr=365, 2yr=720, 3yr=1095, 4yr=1460, 5yr=1825, 6yr=2190 & 7yr=2555",
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend retentionDays = trim(' ', tostring(properties.retentionInDays))\r\n| project retentionDays",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "f87b71cc-4738-41b7-8625-63656640e6ad",
                        "version": "KqlParameterItem/1.0",
                        "name": "SentinelCap",
                        "type": 1,
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend sku = tolower(properties.sku.name)\r\n| extend capacityReservationLevel = properties.sku.capacityReservationLevel\r\n// add fake level for testing\r\n//| extend capacityReservationLevel = 200 , sku = \"capacityreservation\"\r\n//\r\n| project capacityReservationLevel\r\n\r\n\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "72f36500-a03a-42ed-bac1-db83d92ca534",
                        "version": "KqlParameterItem/1.0",
                        "name": "discountRate",
                        "type": 1,
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend sku = tolower(properties.sku.name)\r\n| extend capacityReservationLevel = properties.sku.capacityReservationLevel\r\n// add fake level for testing\r\n//| extend capacityReservationLevel = 2000 , sku = \"capacityreservation\"\r\n| extend discountRate = case(\r\ncapacityReservationLevel == 100,50,\r\ncapacityReservationLevel == 200,55,\r\ncapacityReservationLevel == 300,57,\r\ncapacityReservationLevel == 400,58,\r\ncapacityReservationLevel == 500,60,\r\ncapacityReservationLevel == 1000,61,\r\ncapacityReservationLevel == 2000,63,\r\ncapacityReservationLevel >= 5000,65,\r\n// else\r\n0\r\n)\r\n| project discountRate\r\n\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "lawCap",
                        "type": 1,
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| project capacityReservationLevel = properties.sku.capacityReservationLevel\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "id": "2665b7ce-d7df-4130-a67f-1486b598edb7"
                      },
                      {
                        "id": "2b57d534-a06f-43c3-a6da-b01158540eab",
                        "version": "KqlParameterItem/1.0",
                        "name": "SentinelSku",
                        "type": 1,
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| project sku = tolower(properties.sku.name)",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      }
                    ],
                    "style": "above",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "name": "parameters - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend sku = tolower(properties.sku.name)\r\n| extend capacityReservationLevel = properties.sku.capacityReservationLevel\r\n// add fake level for testing\r\n//| extend capacityReservationLevel = 5000 , sku = \"capacityreservation\"\r\n//\r\n| extend pricingTier = case(\r\nsku == 'capacityreservation' and capacityReservationLevel == 100,\r\n'100 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 200,\r\n'200 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 300,\r\n'300 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 400,\r\n'400 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 500,\r\n'500 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 1000,\r\n'1000 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 2000,\r\n'2000 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel >= 5000,\r\n'5000 GB/day and above Commitment Tier',\r\nsku == 'free',\r\n'Free',\r\nsku == 'standard',\r\n'Standard',\r\nsku == 'premium',\r\n'Premium',\r\nsku == 'standalone',\r\n'Standalone',\r\nsku == 'pernode',\r\n'Per Node',\r\nsku == 'lacluster',\r\n'Cluster Level Capacity Reservation',\r\nsku == 'pergb2018' or sku == 'pergb',\r\n'Pay-as-you-go',\r\nstrcat('Unknown:',sku))\r\n| extend discountRate = case(\r\ncapacityReservationLevel == 100,50,\r\ncapacityReservationLevel == 200,55,\r\ncapacityReservationLevel == 300,57,\r\ncapacityReservationLevel == 400,58,\r\ncapacityReservationLevel == 500,60,\r\ncapacityReservationLevel == 1000,61,\r\ncapacityReservationLevel == 2000,63,\r\ncapacityReservationLevel >= 5000,65,\r\n// else\r\n0\r\n)\r\n| extend retentionInSentinel = iif({retentionDays} > 90,({retentionDays} -90) * {GBperday} * {Retention} ,toreal(0))\r\n| project ['Workspace Name']=id,  location, sku, commitmentTier = capacityReservationLevel, discountRate ,  tags, dataRetention = {retentionDays}, dataRetentionMinusFree = {retentionDays}-90, RetentionEstimatedPrice = retentionInSentinel\r\n\r\n\r\n",
                    "size": 4,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RetentionEstimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Workspace",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "query - 16"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where IsBillable == True\r\n| summarize dataPerDay = sum(Quantity)/1000  by bin(TimeGenerated,1d), SentinelCT='{SentinelCap}'\r\n| extend higherCT = case(\r\n                   dataPerDay < 100, 100,\r\n                   dataPerDay > 100  and dataPerDay < 200, 200,\r\n                   dataPerDay > 200  and dataPerDay < 300, 300,\r\n                   dataPerDay > 300  and dataPerDay < 400, 400,\r\n                   dataPerDay > 400  and dataPerDay < 500, 500,\r\n                   dataPerDay > 500  and dataPerDay < 1000, 1000,\r\n                   dataPerDay > 1000 and dataPerDay < 10000, 10000,\r\n                   dataPerDay > 2000 and dataPerDay < 20000, 20000,\r\n                   dataPerDay > 5000 and dataPerDay < 50000, 50000,\r\n                   // else\r\n                   0\r\n                   )\r\n//| extend lowerCT= (higherCT - 100)\r\n\r\n\r\n\r\n",
                    "size": 1,
                    "aggregation": 3,
                    "showAnnotations": true,
                    "title": "Actual Data Volume and Commitment Tier.  Data from: {TimeRange:label}.  ",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "y",
                    "exportParameterName": "yAxis",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "timechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Column1",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "dataPerDay",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "yAxis": [
                        "higherCT",
                        "SentinelCT",
                        "dataPerDay"
                      ],
                      "seriesLabelSettings": [
                        {
                          "seriesName": "higherCT",
                          "label": "Next Commitment Tier"
                        },
                        {
                          "seriesName": "SentinelCT",
                          "label": "Actual Commitment Tier",
                          "color": "purple"
                        },
                        {
                          "seriesName": "dataPerDay",
                          "color": "green"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "query - chart of CR"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### Commitment Tier Insight\r\nThis report, shows the Average GB/day (based on the TimeRange parameter), which is rounded up to the nearest whole number, this is the number the Azure Pricing Calculator requires. https://azure.microsoft.com/pricing/calculator/ for Sentinel.\r\n- The Pay as You Go (PAYG_estimate) is the GB/day multiplied by the [Sentinel Price] parameter, default is 2.0 (the price in $ for EAST US).  This is location and currency neutral, so adjust to your own preferred value.  This is the Daily estimate of the price.\r\n- The Pay as You Go (PAYG_estimate_mthly) is the Monthly (31day) estimate of the price.\r\n- Commitment Tier_Estimate_Monthly is the (PAYG_estimate_mthly) minus any discount for the commitment Tier that is *currently* set.\r\n- Data ingested into Sentinel exceeding the selected daily commitment tier is charged at the effective tier prices. source: https://azure.microsoft.com/pricing/details/azure-sentinel/"
                  },
                  "name": "text - 5 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": " project actual_ = '{GBperday}' , roundUp_ = round(toreal('{GBperday}'),0)\r\n| extend lookBack = 31\r\n| extend roundUp_ = iif(isnan(roundUp_),toreal(0),toreal(roundUp_))\r\n| extend PAYG_estimate = roundUp_ * {SentinelPrice}\r\n| extend discountRate = iif(isempty('{discountRate}'),\"0\",'{discountRate}')    \r\n| extend PAYG_estimate_mthly = (PAYG_estimate * lookBack)\r\n| extend CT_estimate_mthly = PAYG_estimate_mthly * tolong(discountRate) / 100\r\n| summarize by ['avg GB/day']=roundUp_, PAYG_estimate, PAYG_estimate_mthly, CT_estimate_mthly",
                    "size": 4,
                    "aggregation": 5,
                    "showAnnotations": true,
                    "title": "Commitment Tier. Price per GB:{SentinelPrice},  Discount %: {discountRate} ",
                    "exportFieldName": "y",
                    "exportParameterName": "yAxis",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "PAYG_estimate",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "PAYG_estimate_mthly",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "avgDataPerDay",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "PAYG_estimate_daily",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_number_PAYG_estimate_1",
                          "sortOrder": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "CT_estimate_mthly",
                          "label": "Commitment Tier estimate mthly",
                          "comment": "Estimated Monthly price"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_number_PAYG_estimate_1",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "name": "query - billing - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//\r\n// Predict data volume for the next month\r\n//\r\nlet endDate   = now();     // what is the date now\r\nlet projectTo = now()+90d; // project forward nn days\r\nlet projectForward = 90;   // must be same as projectTo value\r\nUsage\r\n| where StartTime {TimeRange:value}\r\n| where IsBillable == true\r\n| make-series GBytesToday=sum(Quantity) default=0 on TimeGenerated from {TimeRange:start} to projectTo step 1d \r\n| extend GBytesForecast = series_decompose_forecast(GBytesToday, projectForward)\r\n\r\n",
                    "size": 0,
                    "aggregation": 5,
                    "showAnnotations": true,
                    "title": "Actual Data Volume vs. 90 day Prediction.  Data from: {TimeRange:label}.  Minimum 30days suggested, ideally 90days ",
                    "exportFieldName": "y",
                    "exportParameterName": "yAxis",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "GBytesToday",
                          "color": "blueDark"
                        },
                        {
                          "seriesName": "GBytesForecast",
                          "color": "redBright"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 38,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumSignificantDigits": 3
                          }
                        }
                      }
                    }
                  },
                  "name": "query - 20 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//\r\n// Predict data volume for the next month\r\n//\r\nlet startDate = {TimeRange:start}; // go back in time nn days\r\nlet endDate   = now();     // what is the date now\r\nlet projectTo = now()+90d; // project forward nn days\r\nlet projectForward = 90;   // must be same as projectTo value\r\n//union withsource = TableName1 *\r\n//| where TimeGenerated between (startDate .. endDate )\r\nUsage\r\n| where IsBillable == True\r\n| make-series GBytesToday=sum(Quantity)/1000 default=0 on TimeGenerated from {TimeRange:start} to projectTo step 1d \r\n| extend GBytesForecast = series_decompose_forecast(GBytesToday, projectForward)\r\n| extend dayBacks = (toint('{TimeRange:seconds}') / toint(86400))-1\r\n| extend  todayVolume = array_slice(GBytesToday, dayBacks, dayBacks)[0], \r\n          predictionVolume = array_slice(GBytesForecast, array_length( GBytesForecast)-1, array_length( GBytesForecast)-1)[0]\r\n| project priceToday =  todayVolume * {Price},\r\n          pricePrediction = predictionVolume * {Price}, todayVolume, predictionVolume\r\n\r\n",
                    "size": 4,
                    "title": "Actual Data Volume and Price vs. 90 day Prediction. ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "priceToday",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "pricePrediction",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "todayVolume",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 39,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "predictionVolume",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 39,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "UserSelectedAxis",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "GBytesToday",
                          "color": "blueDark"
                        },
                        {
                          "seriesName": "GBytesForecast",
                          "color": "redBright"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 5,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "69",
                  "name": "query - Price Predict"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### Commitment Tier for your Average GB/day value?  \r\nThis report helps you decide:\r\n- A green circle in a Status column 🟢 indicates your are on the Optimal setting, based on your average data ingestion (GB/day) and Pay As You Go/commitment tier settings.\r\n- A recommend value of \"0\" / zero, means that you are on a setting (SKU) such as Free, PerGB etc.. rather than a commitment tier setting.\r\n- If the 'recommend' Sentinel or Workspace setting doesn't match the 'current' setting you will get a Red Cross in the Status columns ❌.\r\n- Please read https://azure.microsoft.com/pricing/details/azure-sentinel/ and https://azure.microsoft.com/pricing/details/monitor/ before deciding. "
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": " project actual_ = '{GBperday}' , roundUp_ = round(toreal('{GBperday}'),0)\r\n| extend lookBack = 31\r\n| extend i = roundUp_ //* 100\r\n| extend i = iif(isnan(i),toreal(0),toreal(i))\r\n// Sentinel commitment tier logic\r\n| extend recommendedSentinelCT = case(\r\n    i  <= 50,\"0\",\r\n    i between (51 .. 180),\"100\",\r\n    i between (181 .. 286),\"200\",\r\n    i between (287 .. 390),\"300\",\r\n    i between (391 .. 476),\"400\",\r\n    i between (477 .. 975),\"500\",\r\n    i between (976 .. 1897),\"1000\",\r\n    i between (1898 .. 4729),\"2000\",\r\n    i >= 4730 ,\"5000\",\r\n    //else\r\n    strcat(\"unknown Sentinel CT: \", i)\r\n)\r\n// Azure Log Analytics (LAW) commitment tier logic\r\n| extend recommendedWorkspaceCT = case(\r\n    i <= 85,\"0\",\r\n    i between (86 .. 187),\"100\",\r\n    i between (188 .. 293),\"200\",\r\n    i between (294 .. 391),\"300\",\r\n    i between (392 .. 491),\"400\",\r\n    i between (492 .. 982),\"500\",\r\n    i between (983 .. 1952),\"1000\",\r\n    i between (1953 .. 4849),\"2000\",\r\n    i >= 4850 ,\"5000\",\r\n    //else\r\n    strcat(\"unknown LAW CT: \", i)\r\n)\r\n| extend avgDataPerDay = i\r\n| extend currentSentinelCT = iif(isempty('{SentinelCap}'),\"0\",'{SentinelCap}')\r\n| extend currentWorkspaceCT = iif(isempty('{lawCap}'),\"0\",'{lawCap}')\r\n| extend sentinelOptimal = iif(recommendedSentinelCT == currentSentinelCT,1,0)\r\n| extend lawOptimal = iif(recommendedWorkspaceCT == currentWorkspaceCT,1,0)\r\n| summarize by ['avg GB/day']=avgDataPerDay,['Sentinel Status']=sentinelOptimal, ['Log Analytics Status']=lawOptimal, recommendedSentinelCT, recommendedWorkspaceCT,currentSentinelCT, currentWorkspaceCT",
                    "size": 4,
                    "title": "Commitment Tier Recommendations",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Sentinel Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "failed",
                                "text": ""
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "If Current and Recommended settings dont match the avg. GB/day - look to adjust? "
                          }
                        },
                        {
                          "columnMatch": "Log Analytics Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "failed",
                                "text": ""
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "If Current and Recommended settings dont match the avg. GB/day - look to adjust? "
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - CR optimal"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "sentinel"
            },
            "name": "group - capReservation"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "CEF Usage",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## CommonSecurityLog (CEF) Insights\r\n- - - "
                  },
                  "name": "text - 15"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where _IsBillable == true\r\n| summarize count(), sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price} , ProductCount=dcount(DeviceProduct), ProductList=make_set(DeviceProduct) by DeviceVendor\r\n| order by sum__BilledSize desc\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "CEF DeviceVendor, count of activity and BilledSize",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "ProductCount",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "whiteBlack",
                            "customColumnWidthSetting": "23ch"
                          }
                        },
                        {
                          "columnMatch": "gb",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "MBytes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_number_estimatedPrice_3",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "count_",
                          "label": "Count"
                        },
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_number_estimatedPrice_3",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "DeviceVendor",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "gb",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "BilledSize"
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "estimatedPrice",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 18,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "Estimated Cost"
                        }
                      },
                      "showBorder": false
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - CEF chart"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where _IsBillable == true\r\n| summarize count(LogSeverity),sum(_BilledSize)  by LogSeverity \r\n| join (CommonSecurityLog\r\n  | make-series Trend = count(LogSeverity) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by LogSeverity\r\n) on LogSeverity\r\n//| extend LogSeverity = round(tolong(LogSeverity),2)\r\n| order by LogSeverity asc\r\n",
                    "size": 0,
                    "title": "CEF count by Severity, BilledSize and Trend",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "LogSeverity",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "is Empty",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": "{0}{1}"
                            }
                          ]
                        },
                        "tooltipFormat": {
                          "tooltip": "Log Severity Value"
                        }
                      },
                      "subtitleContent": {
                        "columnMatch": "sum__BilledSize",
                        "formatter": 8,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 36,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "BilledSize"
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_LogSeverity",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": ""
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 21,
                        "formatOptions": {
                          "palette": "green"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where _IsBillable == true\r\n// add price column \r\n| summarize sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price} by DeviceVendor, DeviceName, DeviceProduct\r\n| order by DeviceVendor asc\r\n// add cost by facility \r\n",
                    "size": 1,
                    "aggregation": 3,
                    "title": "Data by CEF Vendors, from: {TimeRange:label} , count: {$rowCount}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "DeviceVendor"
                        ],
                        "expandTopLevel": true
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_number_estimatedPrice_5",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_number_estimatedPrice_5",
                        "sortOrder": 2
                      }
                    ],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ],
                      "xSettings": {},
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "query - CEF chart - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where _IsBillable == true\r\n| summarize count(), sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price}  by DeviceEventClassID, DeviceVendor, DeviceName, DeviceProduct, LogSeverity\r\n| order by sum__BilledSize, estimatedPrice desc\r\n",
                    "size": 1,
                    "aggregation": 3,
                    "title": "Data by CEF Vendors, from: {TimeRange:label} , filter by DeviceEventClassID, count: {$rowCount}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LogSeverity",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "DeviceVendor"
                        ],
                        "expandTopLevel": true
                      }
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ],
                      "xSettings": {},
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "query - CEF DeviceEventClassID"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| summarize dcount(DeviceEventClassID),  sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price}  by DeviceVendor,  SourceIP, DestinationIP, _ResourceId\r\n",
                    "size": 1,
                    "title": "CEF: data set - {TimeRange:label}, count: {$rowCount}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "_ResourceId",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "BilledSize",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "expectedEventCounts",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Score",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "10ch"
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "pink"
                          }
                        },
                        {
                          "columnMatch": "baseline",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "anomalies",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "EventID",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "dcount_DeviceEventClassID",
                          "label": "Count of unique ClassIDs",
                          "comment": "DeviceEventClassIDs"
                        },
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        },
                        {
                          "columnId": "estimatedPrice",
                          "label": "Estimated Price"
                        }
                      ]
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "Activity",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "EventID",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 2,
                      "topContent": {
                        "columnMatch": "Activity",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "EventID",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "nodeIdField": "Activity",
                      "sourceIdField": "Activity",
                      "targetIdField": "EventID",
                      "graphOrientation": 3,
                      "showOrientationToggles": false,
                      "nodeSize": null,
                      "staticNodeSize": 100,
                      "colorSettings": {
                        "nodeColorField": "GBytes",
                        "type": 1,
                        "colorPalette": "cool"
                      },
                      "hivesMargin": 5
                    }
                  },
                  "name": "query - CEF events"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "cef"
            },
            "name": "group - CEF"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Syslog Usage",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Syslog\r\n| where _IsBillable == true\r\n| summarize count(), sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price} by Facility\r\n| order by count_ desc\r\n",
                    "size": 0,
                    "title": "Syslog Facility, count of activity and BilledSize",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "50ch"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "count_",
                          "label": "Count"
                        },
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "name": "query - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Syslog\r\n| where _IsBillable == true\r\n| summarize count(SeverityLevel), sum(_BilledSize) by SeverityLevel \r\n| join (Syslog\r\n  | make-series Trend = count(SeverityLevel) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SeverityLevel\r\n) on SeverityLevel\r\n",
                    "size": 0,
                    "title": "Syslog count by Severity, BilledSize and Trend",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "50ch"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "SeverityLevel",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "info",
                              "representation": "1",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "warn",
                              "representation": "2",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "notice",
                              "representation": "Important",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "err",
                              "representation": "error",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "alert",
                              "representation": "warning",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": "{0}{1}"
                            }
                          ]
                        },
                        "tooltipFormat": {}
                      },
                      "subtitleContent": {
                        "columnMatch": "sum__BilledSize",
                        "formatter": 8,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 36,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "BilledSize"
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_SeverityLevel",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "Count"
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 21,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "tooltipFormat": {
                          "tooltip": "Trend"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 0 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Syslog\r\n| where _IsBillable == true\r\n| summarize sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price} by HostName, SeverityLevel, Facility, SyslogMessage, ProcessName\r\n| order by sum__BilledSize desc ",
                    "size": 0,
                    "title": "Syslog by Hostname: detailed view",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "SeverityLevel",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "warn",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "info",
                                "representation": "info",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "err",
                                "representation": "error",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "alert",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "notice",
                                "representation": "Normal",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "50ch"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "HostName",
                          "Facility"
                        ]
                      },
                      "labelSettings": [
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        }
                      ]
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "SeverityLevel",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "info",
                              "representation": "1",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "warn",
                              "representation": "2",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "notice",
                              "representation": "Important",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "err",
                              "representation": "error",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "alert",
                              "representation": "warning",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": "{0}{1}"
                            }
                          ]
                        },
                        "tooltipFormat": {}
                      },
                      "subtitleContent": {
                        "columnMatch": "sum__BilledSize",
                        "formatter": 8,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "BilledSize"
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_SeverityLevel",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "Count"
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 21,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "tooltipFormat": {
                          "tooltip": "Trend"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "name": "query - 0 - Copy - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "syslog"
            },
            "name": "group - syslog"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource=TableName1 *\r\n| where TimeGenerated > ago(30d)\r\n| summarize Entries = count(), Size = sumif(_BilledSize, _IsBillable==true), last_log = datetime_diff(\"second\",now(), max(TimeGenerated)), estimate  = sumif(_BilledSize, _IsBillable==true)  by TableName1, _IsBillable\r\n| project ['Table Name'] = TableName1, ['Table Size'] = Size , ['% of Total GB'] = (Size /(1024*1024*1024)) / {GBtotal}  * 100,['IsBillable'] = _IsBillable, ['Last Record Received'] =  last_log , ['Estimated Table Price'] =  (estimate/(1024*1024*1024)) * {Price}\r\n | order by ['Table Size']  desc\r\n\r\n ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "{Workspace:name} Details for 30days, total: {GBtotal} GB",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "Table Name",
                    "exportParameterName": "Table",
                    "exportDefaultValue": "All Tables",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "%",
                          "formatter": 1,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "IsBillable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "blueDark",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated Table Price",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Entries",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "green"
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Size per Entry",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "orange"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          }
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "Table Size",
                          "label": "",
                          "comment": "Capacity of the Table"
                        },
                        {
                          "columnId": "IsBillable",
                          "comment": "Is the Table Free or Billable?"
                        },
                        {
                          "columnId": "Last Record Received",
                          "comment": "When did the last record arrive?"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "75",
                  "conditionalVisibility": {
                    "parameterName": "selectDepthLevel",
                    "comparison": "isEqualTo",
                    "value": "Advanced"
                  },
                  "name": "query - 2 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| extend IsBillable = iif(IsBillable == True,\"Billable\",\"Free\")\r\n| summarize sum(Quantity) by IsBillable\r\n\r\n\r\n ",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "{Workspace:name} Data use % {selectDepthLevel}",
                    "timeContextFromParameter": "TimeRange",
                    "showRefreshButton": true,
                    "exportFieldName": "Table Name",
                    "exportParameterName": "Table",
                    "exportDefaultValue": "All Tables",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "piechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Entries",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "green"
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Size per Entry",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "orange"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "IsBillable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "blueDark",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated Table Price",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "True",
                          "label": "Billable"
                        },
                        {
                          "seriesName": "False",
                          "label": "Free"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 38,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumSignificantDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectDepthLevel",
                    "comparison": "isEqualTo",
                    "value": "Advanced"
                  },
                  "name": "query - 2 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n// get logs for previous 3 months\r\n| where TimeGenerated between(startofmonth(now(),-3) ..endofmonth(endofmonth(now(),-1)) )\r\n| summarize GBytesTotal=sum(Quantity) / 1000 by month=bin(datepart(\"Month\", TimeGenerated), 1)\r\n// format month so we can sort it\r\n| extend month = case(month==1,strcat(month,'. Jan'),month==2,strcat(month,'. Feb'),month==3, strcat(month,'. Mar'),month==4,strcat(month,'. Apr'),month==5,strcat(month,'. May'),month==6,strcat(month,'. Jun'),month==7, strcat(month,'. Jul'),month==8,strcat(month,'. Aug'),month==9,strcat(month,'. Sep'),month==10,strcat(month,'. Oct'),month==11,strcat(month,'. Nov'),month==12,strcat(month,'. Dec'),\"error\")\r\n| order by month asc\r\n",
                    "size": 0,
                    "title": "Month on Month report - Data Volume",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "categoricalbar",
                    "chartSettings": {
                      "customThresholdLine": "50",
                      "customThresholdLineStyle": 3,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 39,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "query - monthly history"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "group - Cost Overview"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Table Analysis",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where StartTime {TimeRange:value}\r\n| summarize ['Table Size'] =sum(Quantity), Price = {Price} * sum(Quantity)/1000 by ['Table Name'] =DataType,['IsBillable'] =IsBillable\r\n| order by ['Table Size']  desc\r\n// | top 10 by ['Table Size']  desc\r\n\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Top billable Tables, from: {TimeRange:label} data, count: {$rowCount}",
                    "exportFieldName": "Table Name",
                    "exportParameterName": "exportTblName",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Price",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 20 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "find in ({exportTblName}) where isnotempty(Computer)\r\n| summarize GB = sum(_BilledSize) by Computer\r\n| order by GB desc",
                    "size": 0,
                    "title": "Details by Computer (this will only work for Tables that have a [Computer] column)",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "GB",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "exportTblName",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "query - 6"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union\r\n(SecurityEvent\r\n| make-series GBperDay=sum(_BilledSize)/(1024*1024*1024) on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId, Type\r\n| join (SecurityEvent | summarize  ['Table Size']=sum(_BilledSize) by _ResourceId) on _ResourceId\r\n| project-away _ResourceId1, TimeGenerated\r\n),\r\n(\r\nCommonSecurityLog\r\n| make-series GBperDay=sum(_BilledSize)/(1024*1024*1024) on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId, Type\r\n| join (CommonSecurityLog | summarize  ['Table Size']=sum(_BilledSize) by _ResourceId) on _ResourceId\r\n| project-away _ResourceId1, TimeGenerated\r\n),\r\n(\r\nSyslog\r\n| make-series GBperDay=sum(_BilledSize)/(1024*1024*1024) on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId, Type\r\n| join (Syslog | summarize  ['Table Size']=sum(_BilledSize) by _ResourceId) on _ResourceId\r\n| project-away _ResourceId1, TimeGenerated\r\n),\r\n(\r\nEvent\r\n| make-series GBperDay=sum(_BilledSize)/(1024*1024*1024) on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId, Type\r\n| join (Event | summarize  ['Table Size']=sum(_BilledSize) by _ResourceId) on _ResourceId\r\n| project-away _ResourceId1, TimeGenerated\r\n)\r\n| top 10 by ['Table Size']  desc",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Top 10 Costs by Resource, from: {TimeRange:label} data",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "GBperDay",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "GBytesToday",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Cost"
                  },
                  "name": "query - 20 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//find where TimeGenerated {TimeRange:Query} project _BilledSize, _IsBillable, Computer, _ResourceId, EventID\r\nfind withsource=TableName1 in (Event, SecurityEvent, Syslog, CommonSecurityLog) where TimeGenerated {TimeRange:Query} project _BilledSize, _IsBillable, Computer, _ResourceId, EventID, Activity, SyslogMessage, RenderedDescription\r\n| where _IsBillable == true\r\n| summarize ['Table Size'] = sum(_BilledSize) by TableName=TableName1 , EventID,  Activity, RenderedDescription, SyslogMessage\r\n| extend EventDescription = iif(isempty(Activity),RenderedDescription,Activity)\r\n| extend EventDescription = iif(isempty(EventDescription),SyslogMessage,EventDescription)\r\n| project-away RenderedDescription, SyslogMessage, Activity\r\n| top 10 by ['Table Size']  desc",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Top 10 Costs by EventId, from: {TimeRange:label} data",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Cost"
                  },
                  "name": "query - 20 - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource=TableName1 Event, SecurityEvent, Syslog, CommonSecurityLog\r\n| where _IsBillable == true\r\n| summarize ['Table Size'] = sum(_BilledSize), any(RenderedDescription), any(Activity) by TableName = TableName1 , EventID, Computer //, Activity, RenderedDescription, SyslogMessage\r\n//| extend EventDescription = iif(isempty(Activity),RenderedDescription,Activity)\r\n//| extend EventDescription = iif(isempty(EventDescription),SyslogMessage,EventDescription)\r\n//| project-away RenderedDescription, SyslogMessage, Activity\r\n| top 20 by ['Table Size']  desc\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Top 20 Costs by Event, from: {TimeRange:label} data by Computer",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_Table Size_3",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_Table Size_3",
                        "sortOrder": 2
                      }
                    ],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Cost"
                  },
                  "name": "query - 20 - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "https://docs.microsoft.com/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor",
                    "style": "info"
                  },
                  "name": "text - 24"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//union withsource=TableName1 *\r\nfind where TimeGenerated {TimeRange:Query} project _BilledSize, _IsBillable, Computer, _ResourceId\r\n| where _isBillable=true and isnotempty(Computer) \r\n| summarize billedData = sumif(_BilledSize, _IsBillable=~true),\r\n            freeData   = sumif(_BilledSize, _IsBillable=~false) by Computer, _ResourceId\r\n| order by billedData desc\r\n\r\n",
                    "size": 1,
                    "aggregation": 3,
                    "title": "GB used by Computers",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15%"
                          }
                        },
                        {
                          "columnMatch": "billedData",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "freeData",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "MBytes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_billedData_2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_billedData_2",
                        "sortOrder": 2
                      }
                    ],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ],
                      "xSettings": {},
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 20 - GB per Computer"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "table"
            },
            "name": "group - Table"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "capacity"
      },
      "name": "capacity"
    },
    {
      "type": 1,
      "content": {
        "json": "## Weekly Check-in Reminder\r\n\r\n### It's important to stay updated on the latest developments in Microsoft Sentinel to understand how they may impact your customers. \r\n\r\n### We recommend visiting the [What's New in Microsoft Sentinel](https://learn.microsoft.com/en-us/azure/sentinel/whats-new) page at least once a week to keep up with the latest features, updates, and announcements. \r\n\r\n### This will help you stay informed and proactive in addressing any changes that could affect your security operations and customer solutions."
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "new"
      },
      "name": "text - 8"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "contentHub",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### Checking and Updating Content Hub Items\r\n\r\n1. **Navigate to the Content Hub:**\r\n\r\n   - Under **Content management**, select **Content hub**.\r\n\r\n   ![Content Hub Navigation](https://github.com/rishiagg/images/blob/main/SentinelContentHub.png?raw=true)\r\n\r\n2. **Check for Available Updates:**\r\n   - Observe the **Updates** section in the top right corner. If the count is `0`, no action is needed.\r\n   - If the count is greater than `0`, proceed to the next step.\r\n\r\n3. **Update Content Hub Items:**\r\n   - Click on the **Status** dropdown and filter for **Update available**.\r\n   - Select the items that require an update.\r\n   - Click on the **Install/Update** button to update the selected items.\r\n\r\n4. **Verify the Update:**\r\n   - Once the update process is complete, ensure that the **Updates** count is `0`.\r\n   - Confirm that all Content Hub items are now in the **Installed** status.\r\n\r\n---\r\n\r\n---\r\n\r\n\r\n"
            },
            "name": "text - 0"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "contentHub"
      },
      "name": "contentHub"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "fe3a12f8-7dcf-4cd3-93b8-e2cc504839eb",
                  "version": "KqlParameterItem/1.0",
                  "name": "countRuleTemplates",
                  "type": 1,
                  "description": "used in a Tile later - hidden",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"name\",\"columnid\":\"name\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                },
                {
                  "id": "6905ed27-7271-4d75-9402-adf21383f002",
                  "version": "KqlParameterItem/1.0",
                  "name": "countActiveRules",
                  "type": 1,
                  "description": "used in a Tile later - hidden",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"name\",\"columnid\":\"name\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                },
                {
                  "id": "6036245c-70ea-448d-9643-8d1c99b97742",
                  "version": "KqlParameterItem/1.0",
                  "name": "huntingQueries",
                  "type": 1,
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{Workspace}/SavedSearches\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-12-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value..properties[?(@ == \\\"Hunting Queries\\\")]\",\"columns\":[]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 12
                },
                {
                  "id": "3e824f1e-1817-448e-aacd-4abd357a2fad",
                  "version": "KqlParameterItem/1.0",
                  "name": "activeRulesUpdatedDate",
                  "type": 1,
                  "description": "used in a Tile later - hidden",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.lastModifiedUtc\",\"columnid\":\"lastMod\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                },
                {
                  "id": "91c045fb-d5a1-406c-93d3-dbc92014bec8",
                  "version": "KqlParameterItem/1.0",
                  "name": "countbyCategory",
                  "type": 1,
                  "description": "used in a Tile later - hidden",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"kind\",\"columnid\":\"kind\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                },
                {
                  "id": "b7fa83fb-adc9-4be0-b06e-9f61c41c649e",
                  "version": "KqlParameterItem/1.0",
                  "name": "countByActiveCategory",
                  "type": 1,
                  "description": "used in a Tile later - hidden",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"kind\",\"columnid\":\"kind\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                }
              ],
              "style": "above",
              "queryType": 12
            },
            "name": "parameters - 27"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "22ed8771-4f7a-4ed1-bb14-882b863be85e",
                        "version": "KqlParameterItem/1.0",
                        "name": "SeparateTables",
                        "label": "Display the Active and Template Rules",
                        "type": 10,
                        "description": "Explanation...Rishi...",
                        "isRequired": true,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n { \"value\": \"No\", \"label\": \"No\", \"selected\":true },\r\n { \"value\": \"Yes\", \"label\": \"Yes\" }\r\n ]",
                        "value": "Yes"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2024-03-01\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"properties.templateVersion\",\"columnid\":\"templateVersion\"},{\"path\":\"kind\",\"columnid\":\"kind\"},{\"path\":\"properties.enabled\",\"columnid\":\"status\"},{\"path\":\"properties.lastModifiedUtc\",\"columnid\":\"lastModifiedUtc\"},{\"path\":\"properties.productFilter\",\"columnid\":\"productFilter\"},{\"path\":\"name\",\"columnid\":\"name\"},{\"path\":\"properties.alertRuleTemplateName\",\"columnid\":\"templateId\"}]}}]}",
                    "size": 1,
                    "title": "Active Analytic Rules. count: {$rowCount}",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 12,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "kind",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "gray",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "disabled",
                                "text": "Disabled"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "Enabled"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tactics",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          }
                        },
                        {
                          "columnMatch": "queryText",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          }
                        },
                        {
                          "columnMatch": "resourcegroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "productFilter",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "productFilter",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "SeparateTables",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "showPin": true,
                  "name": "query - 21 - Rules in use "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2024-03-01\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"properties.version\",\"columnid\":\"version\"},{\"path\":\"kind\",\"columnid\":\"kind\"},{\"path\":\"properties.status\",\"columnid\":\"status\"},{\"path\":\"properties.requiredDataConnectors\",\"columnid\":\"requiredDataConnectors\"},{\"path\":\"properties.requiredDataConnectors[*].dataTypes[0]\",\"columnid\":\"connectorTable\"},{\"path\":\"name\",\"columnid\":\"name\"}]}}]}",
                    "size": 1,
                    "title": " Available Template Rules. count: {$rowCount}",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 12,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "requiredDataConnectors",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "CellDetails",
                            "linkLabel": "Data Connectors",
                            "linkIsContextBlade": true
                          }
                        },
                        {
                          "columnMatch": "queryText",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "resourcegroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "SeparateTables",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "showPin": true,
                  "name": "query - 21 - Rules"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "\r\n### **Version Mismatch Check Instructions**\r\n\r\n#### Mismacthed version is calculated based on the comparison between `Active Analytic Version` and `Template Analytics Version Available` in the Format `a.b.c`.\r\n\r\n1. **Priority Order:**\r\n   - **Highest Priority:** Ensure that all **Active Analytic Rule Versions** are not null. \r\n     - *Note:* Some versions might be null in cases where `Active Analytic Name` contains `Create incidents based on`. Ignore these analytics.\r\n\r\n2. **Ignore Criteria:**\r\n   - If the **Active Analytic Rule Version** is greater than the **Template Analytic Version**, no action is required.\r\n\r\n3. **Action Required:**\r\n   - If the **Active Analytic Rule Version** is less than the **Template Analytic Version**.\r\n     - Follow the update instructions from the below section to ensure consistency across all rules.\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"8c021a32-814f-445a-8f20-55847f6750c2\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - 21 - Rules\",\"rightTable\":\"query - 21 - Rules in use \",\"leftColumn\":\"name\",\"rightColumn\":\"templateId\"}],\"projectRename\":[{\"originalName\":\"[query - 21 - Rules in use ].displayName\",\"mergedName\":\"Active Analytic Name\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].displayName\",\"mergedName\":\"Template Analytics Name\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules in use ].templateVersion\",\"mergedName\":\"Active Analytic Version\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules].version\",\"mergedName\":\"Template Analytics Version Available\",\"fromId\":\"unknown\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Mismatched Version\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Active Analytic Version\",\"operator\":\"!=\",\"rightValType\":\"column\",\"rightVal\":\"Template Analytics Version Available\",\"resultValType\":\"static\",\"resultVal\":\"Version is different\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[query - 21 - Rules in use ].name\",\"mergedName\":\"Active Analytics Unique Id\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].id\",\"mergedName\":\"id\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].templateId\",\"mergedName\":\"Template Id (Mentioned in Active Analytics)\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].templateVersion\",\"mergedName\":\"templateVersion\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules].id\",\"mergedName\":\"id\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules].name\",\"mergedName\":\"Template Id (Mentioned in Content Hub)\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].status\",\"mergedName\":\"Active Status\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules in use ].lastModifiedUtc\"},{\"originalName\":\"[query - 21 - Rules in use ].kind\"},{\"originalName\":\"[query - 21 - Rules].connectorTable\"},{\"originalName\":\"[query - 21 - Rules].requiredDataConnectors\"},{\"originalName\":\"[query - 21 - Rules].kind\"},{\"originalName\":\"[query - 21 - Rules in use ].productFilter\"},{\"originalName\":\"[query - 21 - Rules].status\"}]}",
                    "size": 2,
                    "title": "Compare the Active Analytic Rules to the Available Template Rules. Look for \"Version is different\". Count: {$rowCount}",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Mismatched Version",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "contains",
                                "thresholdValue": "Version",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_thresholds_Mismatched Version_4",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_Mismatched Version_4",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "showPin": false,
                  "name": "query - 30 merge Rules"
                }
              ]
            },
            "name": "group -All Rules"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "analytics"
      },
      "name": "advanceAnalytics"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Data Connectors Validation",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "datatable(recommendationTypeId:string, state:string)\r\n[\r\n    \"Precision_DataValue\", \"Active\",\r\n    \"Precision_UnusedColumns\", \"Active\",\r\n]\r\n",
              "size": 0,
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "1",
              "comparison": "isEqualTo",
              "value": "2"
            },
            "name": "query - 12"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/Recommendations\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2025-01-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[*].properties\",\"columns\":[]}}]}",
              "size": 0,
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "suggestions",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "1",
              "comparison": "isEqualTo",
              "value": "2"
            },
            "name": "query - 11"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/dataConnectors\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-11-01-preview\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.connectorUiConfig.title\",\"columnid\":\"Title\"},{\"path\":\"properties.connectorUiConfig..dataTypes[*].name\",\"columnid\":\"TableName\"},{\"path\":\"properties.connectorUiConfig.publisher\",\"columnid\":\"Publisher\"},{\"path\":\"properties\",\"columnid\":\"properties\"},{\"path\":\"properties.dataTypes.alerts.state\",\"columnid\":\"state\"}]}}]}",
              "size": 1,
              "title": "Data Connector via Rest API. count: {$rowCount}",
              "showExportToExcel": true,
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "requiredDataConnectors",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "Data Connectors",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "queryText",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "resourcegroup",
                    "formatter": 14,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Title",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Title",
                  "sortOrder": 2
                }
              ]
            },
            "name": "query - 21 - Rules"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"3c97372c-6658-4cd6-a57d-f02004b430ab\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - 12\",\"rightTable\":\"query - 11\",\"leftColumn\":\"recommendationTypeId\",\"rightColumn\":\"recommendationTypeId\"}],\"projectRename\":[{\"originalName\":\"[query - 11].title\",\"mergedName\":\"title\",\"fromId\":\"3c97372c-6658-4cd6-a57d-f02004b430ab\"},{\"originalName\":\"[query - 11].description\",\"mergedName\":\"description\",\"fromId\":\"3c97372c-6658-4cd6-a57d-f02004b430ab\"},{\"originalName\":\"[query - 11].lastEvaluatedTimeUtc\",\"mergedName\":\"lastEvaluatedTimeUtc\",\"fromId\":\"3c97372c-6658-4cd6-a57d-f02004b430ab\"},{\"originalName\":\"[query - 11].suggestions\",\"mergedName\":\"suggestions\",\"fromId\":\"3c97372c-6658-4cd6-a57d-f02004b430ab\"},{\"originalName\":\"[query - 11].additionalProperties\",\"mergedName\":\"additionalProperties\",\"fromId\":\"3c97372c-6658-4cd6-a57d-f02004b430ab\"},{\"originalName\":\"[query - 11].recommendationTypeId\"},{\"originalName\":\"[query - 11].state\"},{\"originalName\":\"[query - 11].creationTimeUtc\"},{\"originalName\":\"[query - 11].lastModifiedTimeUtc\"},{\"originalName\":\"[query - 12].recommendationTypeId\"},{\"originalName\":\"[query - 12].state\"},{\"originalName\":\"[query - 11].resourceId\"}]}",
              "size": 0,
              "title": "Tables with Low Usage and Optimization Opportunities",
              "showExportToExcel": true,
              "queryType": 7,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "suggestions",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "dataConnectors"
            },
            "name": "query - 13"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/alertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2024-01-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value.*\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"name\",\"columnid\":\"name\"},{\"path\":\"properties.requiredDataConnectors..[*].connectorId\",\"columnid\":\"requiredDataConnectors\"},{\"path\":\"properties.requiredDataConnectors..[*].dataTypes[*]\",\"columnid\":\"Tables\"},{\"path\":\"properties.severity\",\"columnid\":\"severity\"},{\"path\":\"properties.entityMappings\",\"columnid\":\"entityMappings\"},{\"path\":\"properties.version\",\"columnid\":\"version\"},{\"path\":\"properties.tactics\",\"columnid\":\"tactics\"},{\"path\":\"properties.lastUpdatedDateUTC\",\"columnid\":\"lastUpdatedDateUTC\"},{\"path\":\"properties.createdDateUTC\",\"columnid\":\"createdDateUTC\"},{\"path\":\"properties.status\",\"columnid\":\"status\"}]}}]}",
              "size": 2,
              "title": "Template Rules",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "queryText",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "resourcegroup",
                    "formatter": 14,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  }
                ],
                "rowLimit": 1500,
                "filter": true
              },
              "sortBy": []
            },
            "name": "query - 21 - Rules - Copy"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "dataConnectors"
      },
      "name": "Data Connectors Validation"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Analytics Update Instructions",
        "expandable": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Update Analytics Rules in Microsoft Sentinel\r\n\r\n### Pre-requisites\r\n1. Ensure all connectors are up-to-date – Check the **Content Hub** for updates.\r\n\r\n### Steps to Update Analytics Rules When Version Number is Available\r\n\r\n1. **Identify Rules to Update:**\r\n   - Rules that need to be updated will have an \"update\" tag applied.\r\n\r\n   -    ![Analytics Update](https://github.com/rishiagg/images/blob/main/AnalyticsUpdate.jpeg?raw=true)\r\n\r\n\r\n2. **Review the Rule Properties:**\r\n   - Click on the rule to highlight it.\r\n   - On the right-hand side of the screen, view the rule properties, including current and updated version details.\r\n   - Click on **Review and update**.\r\n\r\n   - ![Review Update](https://github.com/rishiagg/images/blob/main/ReviewUpdate.png?raw=true)\r\n\r\n\r\n3. **Compare Changes:**\r\n   - The next screen will show the changes made by the update.\r\n   - Note any customizations that were made to the rule previously so they can be re-implemented in the new version.\r\n   - Copy the existing rule KQL and the latest version KQL into the Sentinel logs section to compare the output.\r\n   - Review the highlighted changes (e.g., additions to MITRE ATT&CK Tactics and Techniques).\r\n\r\n4. **Proceed with Update:**\r\n   - After confirming that the updates will not break existing configurations, click **Next: General**.\r\n\r\n5. **Set Rule Logic:**\r\n   - Click **Next: Set Rule Logic**.\r\n   - Make necessary changes in the Rule Logic, e.g., re-implement previous customizations.\r\n   - Click **Next: Incident Settings**.\r\n\r\n6. **Automated Response Settings:**\r\n   - Click **Next: Automated Response**.\r\n\r\n7. **Review and Save:**\r\n   - Click **Next: Review + Create**.\r\n   - Click **Save** to apply the changes.\r\n\r\n8. **GitHub Synchronization (If Applicable):**\r\n   - If the rule is stored in a GitHub repository, manually upload and synchronize it; otherwise, changes may be overwritten.\r\n\r\n9. **Acknowledge Save:**\r\n   - Click **Yes** to acknowledge the save confirmation.\r\n   \r\n   - ![SureSave](https://github.com/rishiagg/images/blob/main/SureSave.png?raw=true)\r\n\r\n\r\n### Update When No Version Information is Available\r\n\r\n1. **Check for Template Comparison:**\r\n   - Highlight the rule.\r\n   - If the rule was created from the Microsoft repositories, there will be an option to **Compare with Template**.\r\n\r\n2. **Follow Update Steps:**\r\n   - Click on **Compare with Template** and follow the steps outlined in the “Steps to Update When Version Number is Available” section.\r\n\r\n### Upload Updated Rule to GitHub\r\n\r\n1. **Locate the Rule:**\r\n   - Go to the Analytics blade and sort by date to find the updated rule.\r\n\r\n2. **Export the Rule:**\r\n   - Check the rule and click **Export**.\r\n   - A file will be downloaded to your **Downloads** folder.\r\n\r\n3. **Rename the File:**\r\n   - Rename the downloaded file to match the rule name. You can double-click on the name in the right-hand side pane within Sentinel for reference.\r\n\r\n4. **Upload to GitHub:**\r\n   - Navigate to your GitHub repository and find the corresponding analytics rule file.\r\n\r\n   - ![Directory](https://github.com/rishiagg/images/blob/main/Directory.png?raw=true)\r\n   \r\n   - ![DirectoryFile](https://github.com/rishiagg/images/blob/main/DirectoryFile.png?raw=true)\r\n \r\n\r\n   - Right-click on the file and select **Open File Location**.\r\n\r\n5. **Overwrite the File:**\r\n   - Overwrite the file with the updated rule from your Downloads folder.\r\n\r\n6. **Commit and Push Changes:**\r\n   - Open GitHub Desktop and click on **Commit to main**.\r\n   - Once committed, click **Push Origin**.\r\n\r\n### Best Practices\r\n\r\n- To avoid multiple executions and reduce the likelihood of GitHub resources being throttled, it's best to batch updates and perform multiple commits at the same time.\r\n\r\n---\r\n"
            },
            "name": "text - 0"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "analytics"
      },
      "name": "analytics"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "fe3a12f8-7dcf-4cd3-93b8-e2cc504839eb",
                  "version": "KqlParameterItem/1.0",
                  "name": "countRuleTemplates",
                  "type": 1,
                  "description": "used in a Tile later - hidden",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"name\",\"columnid\":\"name\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                },
                {
                  "id": "6905ed27-7271-4d75-9402-adf21383f002",
                  "version": "KqlParameterItem/1.0",
                  "name": "countActiveRules",
                  "type": 1,
                  "description": "used in a Tile later - hidden",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"name\",\"columnid\":\"name\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                },
                {
                  "id": "6036245c-70ea-448d-9643-8d1c99b97742",
                  "version": "KqlParameterItem/1.0",
                  "name": "huntingQueries",
                  "type": 1,
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{Workspace}/SavedSearches\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-12-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value..properties[?(@ == \\\"Hunting Queries\\\")]\",\"columns\":[]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 12
                },
                {
                  "id": "3e824f1e-1817-448e-aacd-4abd357a2fad",
                  "version": "KqlParameterItem/1.0",
                  "name": "activeRulesUpdatedDate",
                  "type": 1,
                  "description": "used in a Tile later - hidden",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.lastModifiedUtc\",\"columnid\":\"lastMod\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                },
                {
                  "id": "91c045fb-d5a1-406c-93d3-dbc92014bec8",
                  "version": "KqlParameterItem/1.0",
                  "name": "countbyCategory",
                  "type": 1,
                  "description": "used in a Tile later - hidden",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"kind\",\"columnid\":\"kind\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                },
                {
                  "id": "b7fa83fb-adc9-4be0-b06e-9f61c41c649e",
                  "version": "KqlParameterItem/1.0",
                  "name": "countByActiveCategory",
                  "type": 1,
                  "description": "used in a Tile later - hidden",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"kind\",\"columnid\":\"kind\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                }
              ],
              "style": "above",
              "queryType": 12
            },
            "name": "parameters - 27"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2024-03-01\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"properties.templateVersion\",\"columnid\":\"templateVersion\"},{\"path\":\"kind\",\"columnid\":\"kind\"},{\"path\":\"properties.enabled\",\"columnid\":\"status\"},{\"path\":\"properties.tactics\",\"columnid\":\"Tactics\"},{\"path\":\"properties.techniques\",\"columnid\":\"Techniques\"},{\"path\":\"properties.lastModifiedUtc\",\"columnid\":\"lastModifiedUtc\"},{\"path\":\"properties.productFilter\",\"columnid\":\"productFilter\"},{\"path\":\"name\",\"columnid\":\"name\"},{\"path\":\"properties.alertRuleTemplateName\",\"columnid\":\"templateId\"}]}}]}",
                    "size": 2,
                    "title": "Active Analytic Rules. count: {$rowCount}",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 12,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "kind",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "gray",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "disabled",
                                "text": "Disabled"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "Enabled"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tactics",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          }
                        },
                        {
                          "columnMatch": "queryText",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          }
                        },
                        {
                          "columnMatch": "resourcegroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "productFilter",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "productFilter",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "showPin": true,
                  "name": "query - 21 - Rules in use "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2024-03-01\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"properties.version\",\"columnid\":\"version\"},{\"path\":\"kind\",\"columnid\":\"kind\"},{\"path\":\"properties.tactics\",\"columnid\":\"Tactics\"},{\"path\":\"properties.techniques\",\"columnid\":\"Techniques\"},{\"path\":\"properties.status\",\"columnid\":\"status\"},{\"path\":\"properties.requiredDataConnectors\",\"columnid\":\"requiredDataConnectors\"},{\"path\":\"properties.requiredDataConnectors[*].dataTypes[0]\",\"columnid\":\"connectorTable\"},{\"path\":\"name\",\"columnid\":\"name\"}]}}]}",
                    "size": 1,
                    "title": " Available Template Rules. count: {$rowCount}",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 12,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "requiredDataConnectors",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "CellDetails",
                            "linkLabel": "Data Connectors",
                            "linkIsContextBlade": true
                          }
                        },
                        {
                          "columnMatch": "queryText",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "resourcegroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "showPin": true,
                  "name": "query - 21 - Rules"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "\r\n### **TTP Mismatch Check Instructions**\r\n\r\n#### Mismacthed TTP is calculated based on the comparison between `Active Analytic TTPs` and `Template Analytics TTPs Available` .\r\n\r\n\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"8c021a32-814f-445a-8f20-55847f6750c2\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - 21 - Rules\",\"rightTable\":\"query - 21 - Rules in use \",\"leftColumn\":\"name\",\"rightColumn\":\"templateId\"}],\"projectRename\":[{\"originalName\":\"[query - 21 - Rules in use ].displayName\",\"mergedName\":\"Active Analytic Name\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].displayName\",\"mergedName\":\"Template Analytics Name\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules in use ].Techniques\",\"mergedName\":\"Active Techniques\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules].Techniques\",\"mergedName\":\"Template Techniques\",\"fromId\":\"unknown\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Mismatched Technique\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Active Techniques\",\"operator\":\"!=\",\"rightValType\":\"column\",\"rightVal\":\"Template Techniques\",\"resultValType\":\"static\",\"resultVal\":\"Technique is different\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[query - 21 - Rules in use ].name\",\"mergedName\":\"Active Analytics Unique Id\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].id\",\"mergedName\":\"id\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].templateId\",\"mergedName\":\"Template Id (Mentioned in Active Analytics)\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].templateVersion\",\"mergedName\":\"templateVersion\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules].id\",\"mergedName\":\"id\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules].name\",\"mergedName\":\"Template Id (Mentioned in Content Hub)\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].status\",\"mergedName\":\"Active Status\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules in use ].lastModifiedUtc\"},{\"originalName\":\"[query - 21 - Rules in use ].kind\"},{\"originalName\":\"[query - 21 - Rules].connectorTable\"},{\"originalName\":\"[query - 21 - Rules].requiredDataConnectors\"},{\"originalName\":\"[query - 21 - Rules].kind\"},{\"originalName\":\"[query - 21 - Rules in use ].productFilter\"},{\"originalName\":\"[query - 21 - Rules].status\"},{\"originalName\":\"[query - 21 - Rules in use ].templateVersion\"},{\"originalName\":\"[query - 21 - Rules].version\"},{\"originalName\":\"[query - 21 - Rules in use ].Tactics\"},{\"originalName\":\"[query - 21 - Rules].Tactics\"}]}",
                    "size": 1,
                    "title": "Compare the Active Analytic Rules to the Available Template Rules. Look for \"Technique is different\". Count: {$rowCount}",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Mismatched Technique",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "contains",
                                "thresholdValue": "different",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_thresholds_Mismatched Technique_4",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_Mismatched Technique_4",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "showPin": false,
                  "name": "query - 30 merge Rules"
                }
              ]
            },
            "name": "group -All Rules"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "mitre"
      },
      "name": "mitre"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/recommendations\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2024-01-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties\",\"columnid\":\"properties\"},{\"path\":\"properties.recommendationTypeId\",\"columnid\":\"recommendationTypeId\"},{\"path\":\"properties.state\",\"columnid\":\"state\"},{\"path\":\"properties.title\",\"columnid\":\"title\"},{\"path\":\"properties.description\",\"columnid\":\"description\"},{\"path\":\"properties.lastEvaluatedTimeUtc\",\"columnid\":\"lastEvaluatedTimeUtc\"},{\"path\":\"properties.suggestions\",\"columnid\":\"suggestions\"},{\"path\":\"properties.suggestions[0].title\",\"columnid\":\"suggestionsTitle\"},{\"path\":\"properties.suggestions[0].additionalProperties\",\"columnid\":\"suggestionsEntity1\"},{\"path\":\"properties.suggestions[1].additionalProperties\",\"columnid\":\"suggestionsEntity2\"},{\"path\":\"properties.suggestions[2].additionalProperties\",\"columnid\":\"suggestionsEntity3\"},{\"path\":\"properties.suggestions[3].additionalProperties\",\"columnid\":\"suggestionsEntity4\"}]}}]}",
              "size": 2,
              "showRefreshButton": true,
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "requiredDataConnectors",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "Data Connectors",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "queryText",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "resourcegroup",
                    "formatter": 14,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "title",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "title",
                  "sortOrder": 1
                }
              ]
            },
            "name": "query - 21 - Rules"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "recommendations"
      },
      "name": "recommendations "
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/b4a10294-e9a4-47e3-8dab-94cc23dd16d7/resourcegroups/sentinel-prod-rg/providers/microsoft.operationalinsights/workspaces/bdosecure-law"
  ],
  "fromTemplateId": "sentinel-UserWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}